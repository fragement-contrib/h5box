/*!
* Canvas of VISLite JavaScript Library v1.2.1
* git+https://github.com/oi-contrib/VISLite.git
*/var k=function(r,i){return k=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},k(r,i)};function M(r,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function t(){this.constructor=r}k(r,i),r.prototype=i===null?Object.create(i):(t.prototype=i.prototype,new t)}var C=function(){return C=Object.assign||function(r){for(var i,t=1,e=arguments.length;t<e;t++)for(var n in i=arguments[t])Object.prototype.hasOwnProperty.call(i,n)&&(r[n]=i[n]);return r},C.apply(this,arguments)};var P=function(r,i,t,e,n){var o=Math.cos(t),s=Math.sin(t);return[+((e-r)*o-(n-i)*s+r).toFixed(7),+((e-r)*s+(n-i)*o+i).toFixed(7)]},w=function(r,i,t,e,n){return r.beginPath(),r.translate(t,e),r.rotate(n),r.font=i.fontStyle+" "+i.fontWeight+" "+i.fontSize+"px "+i.fontFamily,r},T=function(r,i,t,e,n,o,s,_){if(n>o){var h=n;n=o,o=h}return s%=2*Math.PI,_>=1.999999*Math.PI||_<=1.999999*-Math.PI?_=2*Math.PI:_%=2*Math.PI,function(a,u,l,p,g,y,v){u<0&&(a+=u,u*=-1);var c,f=[];c=P(0,0,a,g,0),f[0]=c[0],f[1]=c[1],c=P(0,0,u,c[0],c[1]),f[2]=c[0],f[3]=c[1],c=P(0,0,a,y,0),f[4]=c[0],f[5]=c[1],c=P(0,0,u,c[0],c[1]),f[6]=c[0],f[7]=c[1],v(a,a+u,f[0]+l,f[1]+p,f[4]+l,f[5]+p,f[2]+l,f[3]+p,f[6]+l,f[7]+p,.5*(y-g))}(s,_,t,e,n,o,function(a,u,l,p,g,y,v,c,f,R,d){d<0&&(d=-d),r.beginPath(),r.moveTo(l,p),r.arc(t,e,n,a,u,!1),i.arcEndCap=="round"?r.arc(.5*(v+f),.5*(c+R),d,u-Math.PI,u,!0):i.arcEndCap=="-round"?r.arc(.5*(v+f),.5*(c+R),d,u-Math.PI,u,!1):r.lineTo(f,R),r.arc(t,e,o,u,a,!0),i.arcStartCap=="round"?r.arc(.5*(l+g),.5*(p+y),d,a,a-Math.PI,!0):i.arcStartCap=="-round"?r.arc(.5*(l+g),.5*(p+y),d,a,a-Math.PI,!1):r.lineTo(l,p)}),i.arcStartCap=="butt"&&r.closePath(),r},x=function(r,i,t,e){return r.beginPath(),r.moveTo(i+e,t),r.arc(i,t,e,0,2*Math.PI),r},m=function(r,i,t,e,n){return r.beginPath(),r.rect(i,t,e,n),r};function V(r,i,t,e,n){for(var o=0,s="",_=0;_<i.length;_++)r.measureText(s+i[_]).width>t||/\n$/.test(s)?(n(s,((o+=1)-.5)*e),s=i[_]):_==i.length-1?(o+=1,n(s+i[_],(o-.5)*e)):s+=i[_];return o*e}function S(r){var i={fontSize:16,fontFamily:"sans-serif",fontWeight:400,fontStyle:"normal",arcStartCap:"butt",arcEndCap:"butt"},t={fillStyle:"black",strokeStyle:"black",lineWidth:1,lineCap:"butt",lineJoin:"miter",lineDash:[],textAlign:"left",textBaseline:"middle",shadowBlur:0,shadowColor:"black"};return r=="special"?i:r=="init"?t:C(C({},i),t)}var I=function(){function r(i,t,e,n,o){t===void 0&&(t={}),n===void 0&&(n=!1),this.__region=null,this.__onlyRegion=!1,this.__onlyView=!1,this.__specialConfig=S("special"),this.__initConfig=S("init"),this.painter=i.getContext("2d",t),this.__region=e,this.__isPainter=n,this.painter.textBaseline="middle",this.painter.textAlign="left"}return r.prototype.useConfig=function(i,t){if(this.__region&&!this.__onlyView&&["fillStyle","strokeStyle","shadowBlur","shadowColor"].indexOf(i)<0&&this.__region.useConfig(i,t),this.__isPainter&&this.__onlyRegion)return this;if(i=="lineDash")this.painter.setLineDash&&this.painter.setLineDash(t);else if(i in this.__specialConfig)i=="fontSize"&&(t=Math.round(t)),this.__specialConfig[i]=t;else{if(!(i in this.__initConfig))throw new Error("Illegal configuration item of painter : "+i+" !");this.painter[i]=t}return this},r.prototype.fillText=function(i,t,e,n){return n===void 0&&(n=0),this.__region&&!this.__onlyView&&this.__region.fillText(i,t,e,n),this.__isPainter&&this.__onlyRegion||(this.painter.save(),w(this.painter,this.__specialConfig,t,e,n).fillText(i,0,0),this.painter.restore()),this},r.prototype.strokeText=function(i,t,e,n){return n===void 0&&(n=0),this.__region&&!this.__onlyView&&this.__region.strokeText(i,t,e,n),this.__isPainter&&this.__onlyRegion||(this.painter.save(),w(this.painter,this.__specialConfig,t,e,n).strokeText(i,0,0),this.painter.restore()),this},r.prototype.fullText=function(i,t,e,n){return n===void 0&&(n=0),this.__region&&!this.__onlyView&&this.__region.fullText(i,t,e,n),this.__isPainter&&this.__onlyRegion||(this.painter.save(),w(this.painter,this.__specialConfig,t,e,n),this.painter.fillText(i,0,0),this.painter.strokeText(i,0,0),this.painter.restore()),this},r.prototype.fillTexts=function(i,t,e,n,o,s){var _=this;o===void 0&&(o=1.2),s===void 0&&(s=0);var h=0;if(this.__region&&!this.__onlyView&&(h=this.__region.fillTexts(i,t,e,n,o)),this.__isPainter&&this.__onlyRegion)return h;this.painter.save(),w(this.painter,this.__specialConfig,t,e,s);var a=V(this.painter,i,n,this.__specialConfig.fontSize*o,function(u,l){_.painter.fillText(u,0,l)});return this.painter.restore(),a},r.prototype.strokeTexts=function(i,t,e,n,o,s){var _=this;o===void 0&&(o=1.2),s===void 0&&(s=0);var h=0;if(this.__region&&!this.__onlyView&&(h=this.__region.fillTexts(i,t,e,n,o)),this.__isPainter&&this.__onlyRegion)return h;this.painter.save(),w(this.painter,this.__specialConfig,t,e,s);var a=V(this.painter,i,n,this.__specialConfig.fontSize*o,function(u,l){_.painter.strokeText(u,0,l)});return this.painter.restore(),a},r.prototype.fullTexts=function(i,t,e,n,o,s){var _=this;o===void 0&&(o=1.2),s===void 0&&(s=0);var h=0;if(this.__region&&!this.__onlyView&&(h=this.__region.fillTexts(i,t,e,n,o)),this.__isPainter&&this.__onlyRegion)return h;this.painter.save(),w(this.painter,this.__specialConfig,t,e,s);var a=V(this.painter,i,n,this.__specialConfig.fontSize*o,function(u,l){_.painter.fillText(u,0,l),_.painter.strokeText(u,0,l)});return this.painter.restore(),a},r.prototype.beginPath=function(){return this.__region&&!this.__onlyView&&this.__region.beginPath(),this.__isPainter&&this.__onlyRegion||this.painter.beginPath(),this},r.prototype.closePath=function(){return this.__region&&!this.__onlyView&&this.__region.closePath(),this.__isPainter&&this.__onlyRegion||this.painter.closePath(),this},r.prototype.moveTo=function(i,t){return this.__region&&!this.__onlyView&&this.__region.moveTo(i,t),this.__isPainter&&this.__onlyRegion||this.painter.moveTo(Math.round(i)+.5,Math.round(t)+.5),this},r.prototype.lineTo=function(i,t){return this.__region&&!this.__onlyView&&this.__region.lineTo(i,t),this.__isPainter&&this.__onlyRegion||this.painter.lineTo(Math.round(i)+.5,Math.round(t)+.5),this},r.prototype.arc=function(i,t,e,n,o){return this.__region&&!this.__onlyView&&this.__region.arc(i,t,e,n,o),this.__isPainter&&this.__onlyRegion||this.painter.arc(i,t,e,n,n+o,o<0),this},r.prototype.fill=function(){return this.__region&&!this.__onlyView&&this.__region.fill(),this.__isPainter&&this.__onlyRegion||this.painter.fill(),this},r.prototype.stroke=function(){return this.__region&&!this.__onlyView&&this.__region.stroke(),this.__isPainter&&this.__onlyRegion||this.painter.stroke(),this},r.prototype.full=function(){return this.__region&&!this.__onlyView&&this.__region.full(),this.__isPainter&&this.__onlyRegion||(this.painter.fill(),this.painter.stroke()),this},r.prototype.save=function(){return this.__region&&!this.__onlyView&&this.__region.save(),this.__isPainter&&this.__onlyRegion||this.painter.save(),this},r.prototype.restore=function(){return this.__region&&!this.__onlyView&&this.__region.restore(),this.__isPainter&&this.__onlyRegion||this.painter.restore(),this},r.prototype.clip=function(){return this.__region&&!this.__onlyView&&this.__region.clip(),this.__isPainter&&this.__onlyRegion||this.painter.clip(),this},r.prototype.quadraticCurveTo=function(i,t,e,n){return this.__region&&!this.__onlyView&&this.__region.quadraticCurveTo(i,t,e,n),this.__isPainter&&this.__onlyRegion||this.painter.quadraticCurveTo(i,t,e,n),this},r.prototype.bezierCurveTo=function(i,t,e,n,o,s){return this.__region&&!this.__onlyView&&this.__region.bezierCurveTo(i,t,e,n,o,s),this.__isPainter&&this.__onlyRegion||this.painter.bezierCurveTo(i,t,e,n,o,s),this},r.prototype.clearRect=function(i,t,e,n){return this.__region&&!this.__onlyView&&this.__region.clearRect(i,t,e,n),this.__isPainter&&this.__onlyRegion||this.painter.clearRect(i,t,e,n),this},r.prototype.fillArc=function(i,t,e,n,o,s){return this.__region&&!this.__onlyView&&this.__region.fillArc(i,t,e,n,o,s),this.__isPainter&&this.__onlyRegion||T(this.painter,this.__specialConfig,i,t,e,n,o,s).fill(),this},r.prototype.strokeArc=function(i,t,e,n,o,s){return this.__region&&!this.__onlyView&&this.__region.strokeArc(i,t,e,n,o,s),this.__isPainter&&this.__onlyRegion||T(this.painter,this.__specialConfig,i,t,e,n,o,s).stroke(),this},r.prototype.fullArc=function(i,t,e,n,o,s){return this.__region&&!this.__onlyView&&this.__region.fullArc(i,t,e,n,o,s),this.__isPainter&&this.__onlyRegion||(T(this.painter,this.__specialConfig,i,t,e,n,o,s),this.painter.fill(),this.painter.stroke()),this},r.prototype.fillCircle=function(i,t,e){return this.__region&&!this.__onlyView&&this.__region.fillCircle(i,t,e),this.__isPainter&&this.__onlyRegion||x(this.painter,i,t,e).fill(),this},r.prototype.strokeCircle=function(i,t,e){return this.__region&&!this.__onlyView&&this.__region.strokeCircle(i,t,e),this.__isPainter&&this.__onlyRegion||x(this.painter,i,t,e).stroke(),this},r.prototype.fullCircle=function(i,t,e){return this.__region&&!this.__onlyView&&this.__region.fullCircle(i,t,e),this.__isPainter&&this.__onlyRegion||(x(this.painter,i,t,e),this.painter.fill(),this.painter.stroke()),this},r.prototype.fillRect=function(i,t,e,n){return this.__region&&!this.__onlyView&&this.__region.fillRect(i,t,e,n),this.__isPainter&&this.__onlyRegion||m(this.painter,i,t,e,n).fill(),this},r.prototype.strokeRect=function(i,t,e,n){return this.__region&&!this.__onlyView&&this.__region.strokeRect(i,t,e,n),this.__isPainter&&this.__onlyRegion||m(this.painter,i,t,e,n).stroke(),this},r.prototype.fullRect=function(i,t,e,n){return this.__region&&!this.__onlyView&&this.__region.fullRect(i,t,e,n),this.__isPainter&&this.__onlyRegion||(m(this.painter,i,t,e,n),this.painter.fill(),this.painter.stroke()),this},r.prototype.draw=function(){return Promise.resolve()},r.prototype.drawImage=function(i,t,e,n,o,s){var _=this;return s===void 0&&(s=!1),new Promise(function(h){if(_.__region&&!_.__onlyView&&_.__region.fillRect(t,e,n,o),_.__isPainter&&_.__onlyRegion)h({});else if(typeof i!="string"||s)_.painter.drawImage(i,t,e,n,o),h({});else{var a=new Image;a.onload=function(){_.painter.drawImage(a,t,e,n,o),h({})},a.src=i}})},r.prototype.install=function(i){var t=this,e=function(s){if(s in n)throw new Error("VISLite Canvas:Method already exists and cannot be overwritten.");n[s]=function(){for(var _=[],h=0;h<arguments.length;h++)_[h]=arguments[h];var a=i[s].apply(t,_);return a!=null?a:t}},n=this;for(var o in i)e(o);return this},r}(),b=function(r,i){var t={value:function(){return r},setColor:function(e,n){return r.addColorStop(i?i(e):e,n),t}};return t},L=function(r){function i(t,e,n,o){n===void 0&&(n={}),o===void 0&&(o=1);var s=r.call(this,t,n,e?new I(e,{willReadFrequently:!0}):void 0,!0,o)||this;return s.name="Canvas",s.__regionList={},s.__regionAssemble=function(_,h,a,u){for(var l=[],p=0;p<u;p++)l[p]=_;return function(){for(var g=0;g<u;g++){if(l[g]+a<h){l[g]=+(l[g]+a).toFixed(7);break}g<u-1&&(l[g]=_)}return l}}(0,255,10,3),s.__scaleSize=o,s.setRegion(""),s}return M(i,r),i.prototype.config=function(t){for(var e in t)this.useConfig(e,t[e]);return this},i.prototype.reset=function(){return this.config(S()),this},i.prototype.onlyRegion=function(t){return this.__onlyRegion=t,this},i.prototype.onlyView=function(t){return this.__onlyView=t,this},i.prototype.setRegion=function(t){if(this.__region)if(t){if(this.__regionList[t]==null){var e=this.__regionAssemble();this.__regionList[t]="rgb("+e[0]+","+e[1]+","+e[2]+")"}this.__region.useConfig("fillStyle",this.__regionList[t])&&this.__region.useConfig("strokeStyle",this.__regionList[t])}else this.__region.useConfig("fillStyle","#000000")&&this.__region.useConfig("strokeStyle","#000000");return this},i.prototype.getRegion=function(t,e){var n=this;return new Promise(function(o){var s=n.__region?n.__region.painter.getImageData(t-.5,e-.5,1,1):{data:[0,0,0,0]},_=s.data,h=function(){if(n.__region){for(var a in n.__regionList)if("rgb("+_[0]+","+_[1]+","+_[2]+")"==n.__regionList[a]){o(a);break}}o("")};_?h():s.then(function(a){_=a,h()})})},i.prototype.textWidth=function(t){this.painter.save(),w(this.painter,this.__specialConfig,0,0,0);var e=this.painter.measureText(t+"").width;return this.painter.restore(),e},i.prototype.getContext=function(t){return t===void 0&&(t=!1),t?this.__region?this.__region.painter:null:this.painter},i.prototype.getInfo=function(){return{width:this.painter.canvas.width/this.__scaleSize,height:this.painter.canvas.height/this.__scaleSize}},i.prototype.createLinearGradient=function(t,e,n,o){return function(s,_,h,a,u){var l=s.createLinearGradient(_,h,a,u);return b(l)}(this.painter,t,e,n,o)},i.prototype.createRadialGradient=function(t,e,n){return function(o,s,_,h){var a=o.createRadialGradient(s,_,0,s,_,h);return b(a)}(this.painter,t,e,n)},i.prototype.createConicGradient=function(t,e,n,o){return function(s,_,h,a,u){var l=s.createConicGradient(a,_,h);return b(l,u?function(p){return u/(2*Math.PI)*p}:void 0)}(this.painter,t,e,n,o)},i.prototype.getColor=function(t,e){t*=this.__scaleSize,e*=this.__scaleSize;var n=this.painter.getImageData(t-.5,e-.5,1,1).data;return"rgba("+n[0]+","+n[1]+","+n[2]+","+n[3]+")"},i}(I),z=function(r){function i(t,e,n,o){e===void 0&&(e={}),n===void 0&&(n=0),o===void 0&&(o=0);var s=this;if(!t)throw new Error("VISLite Canvas:The mount point requires an HTMLElement type but encountered null.");e=function(g,y){for(var v in g)y[v]=g[v];return y}(e,{region:!0,willReadFrequently:!1}),n=n||t.clientWidth,o=o||t.clientHeight;var _,h=null,a=t;a._vislite_canvas_?(_=a._vislite_canvas_[0],h=a._vislite_canvas_[1]):(_=document.createElement("canvas"),t.appendChild(_),e.region&&(h=document.createElement("canvas")),a._vislite_canvas_=[_,h],t.setAttribute("vislite","Canvas"));for(var u=[h,_],l=0;l<u.length;l++){var p=u[l];p&&(p.style.width=n+"px",p.setAttribute("width",l*n+n+""),p.style.height=o+"px",p.setAttribute("height",l*o+o+""))}return(s=r.call(this,_,h,{willReadFrequently:e.willReadFrequently},2)||this).__canvas=_,s.__el=t,s.painter.scale(2,2),s}return M(i,r),i.prototype.toDataURL=function(){var t=this;return new Promise(function(e){e(t.__canvas.toDataURL())})},i.prototype.bind=function(t,e){var n=this;return this.__el.addEventListener(t,function(o){n.getRegion(o.offsetX,o.offsetY).then(function(s){e(s,o.offsetX,o.offsetY)})}),this},i}(L);export{z as f};
